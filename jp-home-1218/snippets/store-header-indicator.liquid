{%- comment -%}
  Store Header Indicator
  Shows the currently selected store in the header with option to change
{%- endcomment -%}

<div id="store-header-indicator" class="store-header-indicator" title="Click to change store">
  <div class="store-indicator-icon">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
      <circle cx="12" cy="10" r="3"></circle>
    </svg>
  </div>
  <div class="store-indicator-text">
    <span class="store-indicator-label">Pickup at</span>
    <span class="store-indicator-name">Select Store</span>
  </div>
  <div class="store-indicator-arrow">
    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="6 9 12 15 18 9"></polyline>
    </svg>
  </div>
</div>

<style>
  .store-header-indicator {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.75rem;
    background: rgba(112, 160, 98, 0.1);
    border: 1px solid rgba(112, 160, 98, 0.3);
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 0.85rem;
  }
  
  .store-header-indicator:hover {
    background: rgba(112, 160, 98, 0.2);
    border-color: rgba(112, 160, 98, 0.5);
  }
  
  .store-indicator-icon {
    color: var(--color-accent, #70a062);
    display: flex;
    align-items: center;
  }
  
  .store-indicator-text {
    display: flex;
    flex-direction: column;
    line-height: 1.2;
  }
  
  .store-indicator-label {
    font-size: 0.7rem;
    color: #888;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .store-indicator-name {
    font-weight: 600;
    color: var(--color-accent, #70a062);
    white-space: nowrap;
    max-width: 150px;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  
  .store-indicator-arrow {
    color: #999;
    display: flex;
    align-items: center;
  }
  
  /* Mobile adjustments */
  @media (max-width: 767px) {
    .store-header-indicator {
      padding: 0.4rem 0.6rem;
    }
    
    .store-indicator-text {
      display: none;
    }
    
    .store-indicator-arrow {
      display: none;
    }
    
    .store-indicator-icon svg {
      width: 20px;
      height: 20px;
    }
  }
  
  /* Badge for unavailable products */
  .store-unavailable {
    opacity: 0.6;
    position: relative;
  }
  
  .store-unavailable-badge {
    position: absolute;
    top: 10px;
    left: 10px;
    background: #ef4444;
    color: #fff;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: 600;
    z-index: 10;
    text-transform: uppercase;
  }
  
  .store-unavailable .product-item__add-to-cart,
  .store-unavailable .btn--add-to-cart {
    opacity: 0.5;
    pointer-events: none;
  }
</style>

<script>
  // Update header indicator based on stored selection
  (function() {
    document.addEventListener('DOMContentLoaded', function() {
      const indicator = document.getElementById('store-header-indicator');
      if (!indicator) return;
      
      const nameEl = indicator.querySelector('.store-indicator-name');
      if (!nameEl) return;
      
      // Get stored store
      let storedStore = null;
      try {
        storedStore = localStorage.getItem('joels_preferred_store');
      } catch(e) {
        // Try cookie
        const match = document.cookie.match(/joels_preferred_store=([^;]+)/);
        storedStore = match ? match[1] : null;
      }
      
      // Update name
      if (storedStore) {
        const storeNames = {
          'jpp': "Joel's Place Proscenium",
          'jpa': "Joel's Place Alabang"
        };
        nameEl.textContent = storeNames[storedStore] || 'Select Store';
      }
    });
    
    // Listen for store changes
    document.addEventListener('store-selected', function(e) {
      const indicator = document.getElementById('store-header-indicator');
      if (!indicator) return;
      
      const nameEl = indicator.querySelector('.store-indicator-name');
      if (nameEl && e.detail.storeName) {
        nameEl.textContent = e.detail.storeName;
      }
    });
  })();
</script>


